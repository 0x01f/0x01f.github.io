<!doctype html>

<html lang="en">

<head>
  <title>localhost</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="The HTML5 Herald" />
  <meta name="author" content="M4x" />
  <meta name="generator" content="Hugo 0.44" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab|Ruda" />
  <link rel="stylesheet" type="text/css" href="https://0x01f.github.io/css/styles.css" />
</head>

<body>
  <div id="container">
    <header>
      <h1>
                <a href="https://0x01f.github.io/">localhost</a>
            </h1>

      <ul id="social-media">
        
        <li><a href="https://twitter.com/M4x88985494"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
          
        <li><a href="https://github.com/0x01f"><i class="fa fa-github fa-lg" aria-hidden="true"></i></a></li>
            
        <li><a href="mailto:I_am_M4x@protonmail.com"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
        
      </ul>
      
      <p><em>Done with development, it&rsquo;s time to pwn.</em></p>
      
    </header>

    
<nav>
    <ul>
        
        <li>
            <a class="" href="https://0x01f.github.io/post/">
                <i class="fa-li fa  fa-lg"></i><span>ls -l ./post</span>
            </a>
        </li>
        
        <li>
            <a class="" href="https://0x01f.github.io/post/link/">
                <i class="fa-li fa  fa-lg"></i><span>cat ./friends</span>
            </a>
        </li>
        
        <li>
            <a class="" href="https://0x01f.github.io/post/aboutme/">
                <i class="fa-li fa  fa-lg"></i><span>whoami</span>
            </a>
        </li>
        
    </ul>
</nav>

    <main>




<article>

    <h1>如何 pwn 掉一个 arm 的binary</h1>

    
        <aside>
    <ul>
        <li>
            <time class="post-date" datetime="2018-07-31T20:00:54&#43;08:00">Jul 31, 2018</time>
        </li>
        
        

        

        <li>1 min read</li>
    </ul>
</aside>
    

    

<p>这篇文章将以几道 CTF 题目为例讲解 pwn arm binary的一些问题</p>

<h2 id="环境搭建">环境搭建</h2>

<h2 id="环境的搭建过程我之前写过-这里偷个懒直接全文粘贴过来">环境的搭建过程我之前写过, 这里偷个懒直接全文粘贴过来</h2>

<blockquote>
<p>原文链接<a href="http://www.cnblogs.com/WangAoBo/p/debug-arm-mips-on-linux.html">M4x@10.0.0.55</a>
本文中用于展示的binary分别来自Jarvis OJ上pwn的add，typo两道题</p>
</blockquote>

<p>写这篇教程的主要目的是因为最近想搞其他系统架构的 pwn，因此第一步就是搭建环境了，网上搜索了一波，发现很多教程都是需要树莓派，芯片等硬件，然后自己编译 gdb，后来实践的过程中发现可以很简单地使用 qemu 实现运行和调试异架构 binary，因此在这里分享一下我的方法。</p>

<h3 id="主机信息">主机信息：</h3>

<p>以一台新装的 deepin 虚拟机(基于 debian)为例，详细信息如下：</p>

<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5av617a5j30lq0bu78m.jpg" alt="" /></p>

<h3 id="预备环境安装">预备环境安装：</h3>

<ul>
<li>安装 git，gdb 和 gdb-multiarch，同时安装 binfmt 用来识别文件类型</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo apt-get update
$ sudo apt-get install git gdb gdb-multiarch
$ sudo apt-get install <span style="color:#e6db74">&#34;binfmt*&#34;</span></code></pre></div>
<ul>
<li>安装gdb的插件pwndbg（或者gef等支持多架构的插件）</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ git clone https://github.com/pwndbg/pwndbg
$ cd pwndbg
$ ./setup.sh</code></pre></div>
<p>装好之后如图：</p>

<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5c1vzla8j30nb04t75m.jpg" alt="" /></p>

<ul>
<li>安装pwntools，不必要，但绝对是写exp的神器</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  $ sudo pip install pwntools</code></pre></div>
<h3 id="安装qemu">安装qemu：</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo apt-get install qemu-user</code></pre></div>
<p>通过 qemu 模拟 arm/mips 环境，进而进行调试</p>

<h3 id="安装共享库">安装共享库：</h3>

<p>此时已经可以运行静态链接的 arm/mips binary 了，如下图：</p>

<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5crjvp5dj31400p0ngj.jpg" alt="" /></p>

<p>但还不能运行动态链接的 binary，如下图：</p>

<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5csjo38rj313o05i779.jpg" alt="" /></p>

<p>这就需要我们安装对应架构的共享库，可以通过如下命令搜索：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ apt-cache search <span style="color:#e6db74">&#34;libc6&#34;</span> | grep ARCH</code></pre></div>
<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5cudid7gj30xy0h7trd.jpg" alt="" /></p>

<p>我们只需安装类似 <strong>libc6-ARCH-cross</strong> 形式的即可</p>

<h3 id="运行">运行：</h3>

<p>静态链接的 binary 直接运行即可，会自动调用对应架构的 qemu；</p>

<p>动态链接的 bianry 需要用对应的 qemu 同时指定共享库路径，如下图32位的动态链接 mips binary</p>

<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5d1guaxvj313m03bq55.jpg" alt="" /></p>

<p>使用 -L 指定共享库：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ qemu-mipsel -L /usr/mipsel-linux-gnu/ ./add</code></pre></div>
<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5d3xxmfqj30z50c4ahc.jpg" alt="" /></p>

<h3 id="调试">调试：</h3>

<p>可以使用 qemu 的 -g 指定端口</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ qemu-mipsel -g <span style="color:#ae81ff">1234</span> -L /usr/mipsel-linux-gnu/ ./add</code></pre></div>
<p>然后使用gdb-multiarch进行调试，先指定架构，然后使用remote功能</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pwndbg&gt; set architecture mips
pwndbg&gt; target remote localhost:1234</code></pre></div>
<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5dbufgrjj31400p013o.jpg" alt="" /></p>

<p>这样我们就能进行调试了</p>

<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5de5c26aj31400p046h.jpg" alt="" /></p>

<h3 id="效果图">效果图：</h3>

<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5de5c26aj31400p046h.jpg" alt="" /></p>

<p><img src="http://ww1.sinaimg.cn/large/006AWYXBly1fq5dg64kb8j31400p0tgd.jpg" alt="" /></p>

<h3 id="more">more：</h3>

<p>同样，如果想要运行或者调试其他架构的 binary，只需安装其他架构的 qemu 和共享库即可</p>

<h3 id="reference">reference：</h3>

<p><a href="https://docs.pwntools.com/en/stable/qemu.html">https://docs.pwntools.com/en/stable/qemu.html</a></p>

<h2 id="https-reverseengineering-stackexchange-com-questions-8829-cross-debugging-for-arm-mips-elf-with-qemu-toolchain"><a href="https://reverseengineering.stackexchange.com/questions/8829/cross-debugging-for-arm-mips-elf-with-qemu-toolchain">https://reverseengineering.stackexchange.com/questions/8829/cross-debugging-for-arm-mips-elf-with-qemu-toolchain</a></h2>


</article>


<section class="post-nav">
    <ul>
        
        <li>
            <a href="https://0x01f.github.io/post/pin-in-ctf/"><i class="fa fa-chevron-circle-left"></i> Reverse is Multiplex, You Need Pintools</a>
        </li>
        
        
    </ul>
</section>
<head>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
</head>
<body>
    <div id="vcomments"></div>
    <script>
        new Valine({
            el: '#vcomments',
            appId: 'goABwRBvfqsbEkzfPSjlbhDJ-gzGzoHsz',
            appKey: 'jm5HSLcqP40fvEBMOcBwPXPE',
            notify:false,
            verify:true,
            avatar:'wavatar',
            vistor:true,
            placeholder: 'Leave a comment',
            path:window.location.pathname
        })
    </script>
</body>





</main>
    <footer>
        <h6>Copyright &copy; 2018 - M4x | 
            Rendered by <a href="https://gohugo.io" title="Hugo">Hugo</a> |
            <a href="https://0x01f.github.io/index.xml">Subscribe</a></h6>
    </footer>
</div>
<script src="https://0x01f.github.io/js/scripts.js"></script>
</body>

</html>